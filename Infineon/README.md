# 20220219更新内容

## 本次更新为重大更新，主要内容为底层优化，Bug修复，兼容性更强

## 底层方面：

**1.对于Button类的初始化方式做了变动，采用大多数类的初始化方式，即使用Set_Param接口，Init初始化的方式，这样可以对核1/2的兼容性更强，在初始化方面**

**2.对于Button类获取系统时间的方式做了改进，使用平台统一函数platform_getval_ms()接口，使得Button的兼容更强。**

**3.最新的Button类采用类继承的方式，使用更方便。**

**4.对于Buzzer类的中间延时做了改进，采用platform_delay_ms()统一延时函数延时，platform_printf()输出，三核均可使用，兼容性更强。**

## 兼容性方面：

**考虑到之前rtthread系统与核1/2不兼容，而延时和输出函数都是rtthread系统，所以这次绕过rtthread从底层提取了延时和输出函数，并且延时函数能够自动选择STM模块，由于STM0被rt占用，所以该函数能够根据核来选择STM，如果是核0则使用STM0，否则使用STM1；输出函数也是类似的原理，根据核来选择使用rt_printf()和printf ()(该函数已被重定向，并且也是使用UART0，不过不会和rtthread冲突)。**

## Bug修复：

**核1/2的类初始化的顺序有点问题，所以删除了在类里面提前赋值的代码，例如int \*a =NULL;当要在corex_setup()初始化它们时，会在短时间有效，但是后面又会重新变为NULL，所以去除了后面赋值的部分。**

## 发现：

**1.STM模块不需要初始化，可以直接使用。**

**2.程序的执行顺序貌似有点问题，好像先执行corex_setup()里的初始化语句，而后执行类的内部变量类似上面的这种类的内部提前赋值(int \*a =NULL)，本来应该是先执行内部赋，所以尽量不要提前赋值，除非要赋成类的内部常量。**

## 总结：

**引入了platform统一函数，兼容性更强，修复了使用类的一些Bug，同时也找到了正确使用类的方法，同时将部分板载硬件写成模块(工作信号灯，按钮等)。**

